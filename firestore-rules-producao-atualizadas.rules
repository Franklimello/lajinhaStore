rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========================================
    // REGRAS PARA PRODUTOS (LEITURA LIVRE)
    // ========================================
    match /produtos/{produtoId} {
      // Qualquer um pode ler produtos (sem autenticação)
      allow read: if true;
      
      // Apenas administradores podem criar, atualizar ou deletar produtos
      allow write: if request.auth != null && 
                      (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                       request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA CATEGORIAS (LEITURA LIVRE)
    // ========================================
    match /categorias/{categoriaId} {
      // Qualquer um pode ler categorias (sem autenticação)
      allow read: if true;
      
      // Apenas administradores podem criar, atualizar ou deletar categorias
      allow write: if request.auth != null && 
                      (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                       request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA PEDIDOS (Coleção principal)
    // ========================================
    match /pedidos/{pedidoId} {
      // Usuários autenticados podem criar pedidos apenas para si mesmos
      allow create: if request.auth != null && 
                       request.resource.data.userId == request.auth.uid;
      
      // Usuários podem ler apenas seus próprios pedidos
      // Administradores podem ler todos os pedidos
      allow read: if request.auth != null && 
                     (resource.data.userId == request.auth.uid || 
                      request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                      request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
      
      // Usuários podem atualizar apenas seus próprios pedidos
      // Administradores podem atualizar qualquer pedido
      allow update: if request.auth != null && 
                       (resource.data.userId == request.auth.uid || 
                        request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                        request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
      
      // Apenas administradores podem deletar pedidos
      allow delete: if request.auth != null && 
                       (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                        request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA USUÁRIOS (Perfis)
    // ========================================
    match /usuarios/{userId} {
      // Usuários podem ler e atualizar apenas seu próprio perfil
      allow read, update: if request.auth != null && 
                             request.auth.uid == userId;
      
      // Usuários podem criar seu próprio perfil
      allow create: if request.auth != null && 
                       request.auth.uid == userId;
      
      // Administradores podem ler qualquer perfil
      allow read: if request.auth != null && 
                     (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                      request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA NOTIFICAÇÕES (CORRIGIDAS)
    // ========================================
    match /notificacoes/{notificacaoId} {
      // Usuários podem ler apenas suas notificações
      // Administradores podem ler todas as notificações
      allow read: if request.auth != null && 
                     (resource.data.userId == request.auth.uid || 
                      request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                      request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
      
      // Usuários podem atualizar suas notificações (marcar como lida)
      // Administradores podem atualizar qualquer notificação
      allow update: if request.auth != null && 
                       (resource.data.userId == request.auth.uid || 
                        request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                        request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
      
      // Sistema pode criar notificações para usuários
      // Administradores podem criar notificações
      allow create: if request.auth != null;
      
      // Apenas administradores podem deletar notificações
      allow delete: if request.auth != null && 
                       (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                        request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA CONFIGURAÇÕES
    // ========================================
    match /configuracoes/{configId} {
      // Todos os usuários autenticados podem ler configurações
      allow read: if request.auth != null;
      
      // Apenas administradores podem modificar configurações
      allow write: if request.auth != null && 
                      (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                       request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA RELATÓRIOS E ANALYTICS
    // ========================================
    match /relatorios/{relatorioId} {
      // Apenas administradores podem acessar relatórios
      allow read, write: if request.auth != null && 
                           (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                            request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PARA LOGS DO SISTEMA
    // ========================================
    match /logs/{logId} {
      // Apenas administradores podem acessar logs
      allow read, write: if request.auth != null && 
                           (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                            request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
    
    // ========================================
    // REGRAS PADRÃO PARA OUTRAS COLEÇÕES
    // ========================================
    match /{document=**} {
      // Por padrão, usuários autenticados podem ler
      allow read: if request.auth != null;
      
      // Por padrão, apenas administradores podem escrever
      allow write: if request.auth != null && 
                      (request.auth.uid == "ZG5D6IrTRTZl5SDoEctLAtr4WkE2" ||
                       request.auth.uid == "6VbaNslrhQhXcyussPj53YhLiYj2");
    }
  }
}